<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>商单详情 - GetDan</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue",
          sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
        color: #333;
        line-height: 1.6;
        min-height: 100vh;
        /* padding: 20px; */
        padding-bottom: 0px;
      }

      .header {
        background: linear-gradient(90deg, #4a90e2 0%, #5e72eb 100%);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        padding: 20px 0;
        /* position: sticky; */
        top: 0;
        z-index: 100;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0;
      }

      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        font-size: 28px;
        font-weight: bold;
        color: white;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .logo i {
        font-size: 32px;
      }

      .search-bar {
        display: flex;
        width: 400px;
        position: relative;
      }

      .search-bar input {
        flex: 1;
        padding: 12px 20px 12px 40px;
        border: none;
        border-radius: 30px 0 0 30px;
        outline: none;
        font-size: 14px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      }

      .search-bar input:focus {
        box-shadow: 0 2px 12px rgba(74, 144, 226, 0.3);
        transform: scale(1.02);
      }

      .search-bar i {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: #777;
      }

      .search-bar button {
        background: #ff6b6b;
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 0 30px 30px 0;
        cursor: pointer;
        font-weight: bold;
      }

      .search-bar button:hover {
        background: #ff5252;
      }

      .container {
        max-width: 1200px;
        margin: 20px auto;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: #f8f9fa;
        padding: 20px 30px;
        border-bottom: 1px solid #e9ecef;
      }

      .header h1 {
        font-size: 1.5rem;
        color: #333;
        margin: 0;
        font-weight: 600;
      }

      .header p {
        color: #6c757d;
        font-size: 0.9rem;
        margin: 5px 0 0 0;
      }

      .detail-content {
        display: flex;
        min-height: 500px;
      }

      .main-content {
        flex: 1;
        padding: 30px;
        background: #ffffff;
      }

      .order-header {
        margin-bottom: 25px;
        padding-bottom: 20px;
        border-bottom: 1px solid #e9ecef;
      }

      .order-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: #2c3e50;
        margin: 0 0 10px 0;
        line-height: 1.3;
      }

      .order-meta {
        display: flex;
        gap: 15px;
        align-items: center;
      }

      .order-type {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 6px 15px;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 500;
        display: inline-block;
      }

      .order-status {
        padding: 6px 15px;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 500;
        display: inline-block;
      }

      .status-active {
        background: #e8f5e8;
        color: #27ae60;
      }

      .status-completed {
        background: #e3f2fd;
        color: #3498db;
      }

      .status-pending {
        background: #fff3e0;
        color: #f39c12;
      }

      .sidebar {
        width: 350px;
        /* background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); */
        padding: 30px;
        color: white;
      }

      .sidebar-content {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 10px;
        padding: 20px; /* 减少内边距以容纳更多内容 */
        color: #333;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
      }

      .sidebar-section {
        margin-bottom: 20px;
      }

      .sidebar-section:last-child {
        margin-bottom: 0;
      }

      .info-section {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 25px;
        margin-bottom: 25px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .info-section-title {
        font-size: 1.2rem;
        color: #2c3e50;
        margin: -25px -25px 20px -25px;
        padding: 15px 25px;
        border-bottom: 2px solid #f8f9fa;
        font-weight: 600;
        background: #f8f9fa;
        border-radius: 6px 6px 0 0;
      }

      .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 15px;
      }

      .info-item {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid #f8f9fa;
      }

      .info-item:last-child {
        border-bottom: none;
      }

      .info-label {
        font-size: 0.9rem;
        color: #6c757d;
        font-weight: 500;
        min-width: 120px;
      }

      .info-value {
        flex: 1;
        font-size: 1rem;
        color: #495057;
        font-weight: 500;
        text-align: right;
      }

      .project-desc-content {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 6px;
        border-left: 4px solid #667eea;
      }

      .project-desc-text {
        font-size: 1rem;
        line-height: 1.7;
        color: #495057;
        margin: 0;
        padding: 0;
      }

      .requirements-content {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 6px;
      }

      .requirements-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .requirements-list li {
        padding: 10px 0;
        border-bottom: 1px solid #e9ecef;
        display: flex;
        align-items: flex-start;
        font-size: 0.95rem;
      }

      .requirements-list li:before {
        content: "•";
        color: #667eea;
        font-weight: bold;
        display: inline-block;
        width: 20px;
        margin-left: -20px;
      }

      .requirements-list li:last-child {
        border-bottom: none;
      }

      .progress-container {
        margin: 25px 0;
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .progress-bar {
        flex: 1;
        height: 12px;
        background: #e9ecef;
        border-radius: 6px;
        overflow: hidden;
        box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
      }

      .progress-active {
        height: 100%;
        width: 65%;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        border-radius: 6px;
        transition: width 0.3s ease;
      }

      .progress-completed {
        height: 100%;
        width: 100%;
        background: linear-gradient(90deg, #56ab2f 0%, #a8e6cf 100%);
        border-radius: 6px;
        transition: width 0.3s ease;
      }

      .progress-text {
        font-size: 0.9rem;
        color: #6c757d;
        font-weight: 500;
        min-width: 60px;
      }

      .sidebar-title {
        font-size: 1.1rem;
        color: #2c3e50;
        margin: 0 0 20px 0;
        padding-bottom: 12px;
        border-bottom: 2px solid #e9ecef;
        font-weight: 600;
        text-align: center;
      }

      .price-section {
        margin-bottom: 25px;
      }

      .price-tag {
        text-align: center;
        margin-bottom: 20px;
      }

      .price {
        font-size: 2.2rem;
        color: #e74c3c;
        font-weight: 700;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .payment-info {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        margin-top: 15px;
      }

      .payment-info p {
        margin: 8px 0;
        color: #6c757d;
        font-size: 0.9rem;
      }

      .payment-info p i {
        color: #667eea;
        margin-right: 8px;
      }

      .bid-btn {
        display: block;
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        margin-bottom: 15px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      }

      .bid-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
      }

      .contact-btn {
        display: block;
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(86, 171, 47, 0.3);
      }

      .contact-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(86, 171, 47, 0.4);
      }

      .action-section {
        margin: 25px 0;
      }

      .project-stats {
        margin-top: 25px;
      }

      .stat-item {
        display: flex;
        align-items: center;
        padding: 10px 0;
        color: #6c757d;
      }

      .stat-item i {
        width: 24px;
        margin-right: 10px;
        color: #667eea;
      }

      .stat-item span {
        font-size: 0.95rem;
      }

      .stat-value {
        font-weight: 600;
        color: #2c3e50;
      }

      .client-item {
        display: flex;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid #f8f9fa;
        transition: all 0.3s ease;
      }

      .client-item:hover {
        background: #f8f9fa;
        padding-left: 8px;
        border-radius: 6px;
      }

      .client-item:last-child {
        border-bottom: none;
      }

      .requirements-list {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 10px;
      }

      .requirement-tag {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
      }

      .loading {
        text-align: center;
        padding: 40px;
        font-size: 1.2rem;
        color: #7f8c8d;
      }

      .error {
        text-align: center;
        padding: 40px;
        color: #e74c3c;
        font-size: 1.2rem;
      }

      .fade-in {
        animation: fadeIn 0.5s ease-in;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .info-section {
        transition: all 0.3s ease;
        position: relative;
      }

      .info-section:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.12);
        background: #fafbff;
        border-color: #e0e7ff;
      }

      .info-section-title {
        transition: all 0.3s ease;
      }

      .info-section:hover .info-section-title {
        color: #667eea;
        transform: translateX(3px);
      }

      .order-item {
        transition: all 0.3s ease;
      }

      /* 返回按钮样式 */
      .back-button,
      .back-to-home-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 6px;
        padding: 10px 20px;
        font-size: 0.95rem;
        font-weight: 500;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
      }

      .back-button:hover,
      .back-to-home-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
      }

      .back-button i,
      .back-to-home-btn i {
        font-size: 1rem;
      }

      /* 调整返回首页按钮在小屏幕上的样式 */
      @media (max-width: 768px) {
        .back-to-home-btn {
          padding: 8px 15px;
          font-size: 0.85rem;
        }
      }

      @media (max-width: 992px) {
        .detail-content {
          flex-direction: column;
        }

        .main-content,
        .sidebar {
          width: 100%;
        }

        .sidebar {
          width: 100%;
          margin-top: 20px;
        }
      }

      .social-links {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 15px;
      }

      .social-links a {
        display: inline-block;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        color: #ffffff;
        text-align: center;
        line-height: 36px;
        transition: all 0.3s ease;
      }

      .social-links a:hover {
        background: #ffffff;
        color: #667eea;
        transform: translateY(-3px);
      }

      @media (max-width: 768px) {
        .container {
          margin: 10px;
          padding: 0;
        }

        .header {
          padding: 15px 20px;
        }

        .detail-content {
          flex-direction: column;
        }

        .main-content {
          padding: 20px;
        }

        .sidebar {
          padding: 20px;
        }

        .order-title {
          font-size: 1.5rem;
        }

        .info-grid {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .price {
          font-size: 1.8rem;
        }

        .bid-btn,
        .contact-btn {
          padding: 12px;
          font-size: 1rem;
        }
      }

      /* 推荐订单样式 */
      .recommended-orders {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #e9ecef;
      }

      .recommended-item {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .recommended-item:hover {
        background: #e9ecef;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .recommended-title {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 8px;
        font-size: 0.95rem;
        line-height: 1.4;
      }

      .recommended-title:hover {
        color: #667eea;
      }

      .recommended-meta {
        display: flex;
        justify-content: space-between;
        margin-bottom: 6px;
        font-size: 0.85rem;
      }

      .recommended-price {
        color: #e74c3c;
        font-weight: 600;
      }

      .recommended-type {
        color: #7f8c8d;
        background: #ecf0f1;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 0.8rem;
      }

      .recommended-time {
        color: #95a5a6;
        font-size: 0.8rem;
        border-top: 1px solid #e9ecef;
        padding-top: 6px;
      }

      .no-recommendations {
        text-align: center;
        color: #95a5a6;
        font-style: italic;
        padding: 15px 0;
      }
    </style>
  </head>
  <body>
    <!-- <header class="header" style="position: sticky">
      <div class="container">
        <div class="header-content">
          <div class="logo">
            <i class="fas fa-shopping-bag"></i>
            <span>商单展示平台</span>
          </div>
          <div class="search-bar">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="搜索商单、技能或公司..." />
            <button>搜索</button>
          </div>
        </div>
      </div>
    </header> -->

    <div class="container">
      <!-- Added top margin to account for fixed nav -->
      <!-- <div class="header" style="position: sticky">
        <h1><i class="fas fa-file-alt"></i> 商单详情</h1>
        <p>查看商单的详细信息</p>
      </div> -->

      <div id="detail-content">
        <div class="loading">
          <i class="fas fa-spinner fa-spin"></i> 加载中...
        </div>
      </div>
    </div>

    <!-- Full-width Footer -->
    <footer
      style="
        position: relative;
        width: 100%;
        text-align: center;
        padding: 20px 0;
        margin-top: 40px;
        border-top: 1px solid #dee2e6;
        /* background-color: #f8f9fa; */
        color: #6c757d;
        font-size: 0.85rem;
        box-sizing: border-box;
      "
    >
      <p style="margin: 0; max-width: 1200px; margin: 0 auto; padding: 0 20px">
        &copy; 2025 学员接单管理系统 | 为学员提供优质的接单服务
      </p>
    </footer>

    <script>
      // 从URL参数获取订单ID
      function getOrderIdFromUrl() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get("id");
      }

      // 从CSV加载所有订单数据
      async function loadAllOrders() {
        try {
          const response = await fetch("data/任务统计表.csv");
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const csvText = await response.text();
          return parseCSV(csvText);
        } catch (error) {
          console.error("加载订单数据失败:", error);
          document.getElementById(
            "detail-content"
          ).innerHTML = `<div class="error"><i class="fas fa-exclamation-triangle"></i> 加载订单数据失败: ${error.message}</div>`;
          return [];
        }
      }

      // 解析CSV数据
      function parseCSV(csvText) {
        const lines = csvText
          .split(/\r?\n/)
          .filter((line) => line.trim() !== "");
        if (lines.length < 2) return [];

        // 手动定义表头，因为CSV第一行的格式有问题
        const headers = [
          "单子名称",
          "任务类型",
          "订单渠道",
          "接单结果",
          "金额",
          "订单完成日期",
          "接单人员",
          "截图",
          "交付学员结果",
          "学员实收金额",
        ];
        const orders = [];

        for (let i = 1; i < lines.length; i++) {
          const currentLine = lines[i].trim();
          if (
            currentLine === "" ||
            currentLine === ",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"
          )
            continue;

          const values = parseCSVLine(currentLine);
          if (values.length < 6) continue;

          // 创建订单对象，映射到与之前代码兼容的字段名
          const order = {
            商单id: i, // 使用行号作为商单id
            商单标题: values[0] ? values[0].trim() : "",
            需求类型: values[1] ? values[1].trim() : "",
            商单状态: values[3] ? values[3].trim() : "",
            预算范围: values[4] ? values[4].trim() : "",
            发布时间: values[5] ? values[5].trim() : "",
            项目进度: values[3]
              ? values[3].trim().includes("已完成")
                ? "已完成"
                : "进行中"
              : "进行中",
          };
          orders.push(order);
        }

        return orders;
      }

      // 解析CSV行，处理包含逗号的字段
      function parseCSVLine(line) {
        const result = [];
        let current = "";
        let inQuotes = false;

        for (let i = 0; i < line.length; i++) {
          const char = line[i];

          if (char === '"') {
            if (inQuotes && i + 1 < line.length && line[i + 1] === '"') {
              // 处理双引号转义
              current += '"';
              i++; // 跳过下一个引号
            } else {
              // 切换引号状态
              inQuotes = !inQuotes;
            }
          } else if (char === "," && !inQuotes) {
            result.push(current);
            current = "";
          } else {
            current += char;
          }
        }

        result.push(current);
        return result;
      }

      // 根据ID查找订单
      function findOrderById(orders, id) {
        return orders.find((order) => order["商单id"] == id);
      }

      // 随机生成客户信息
      function generateRandomClientInfo() {
        // 随机客户名称
        const companyNames = [
          "科技",
          "信息技术",
          "互联网",
          "数据",
          "智能",
          "数字",
          "网络",
          "软件",
          "电子",
          "通信",
        ];
        const regions = [
          "北京",
          "上海",
          "广州",
          "深圳",
          "杭州",
          "成都",
          "武汉",
          "南京",
          "西安",
          "重庆",
        ];
        const suffixes = [
          "有限公司",
          "科技有限公司",
          "信息技术有限公司",
          "网络科技有限公司",
          "智能科技有限公司",
        ];

        const randomRegion =
          regions[Math.floor(Math.random() * regions.length)];
        const randomName =
          companyNames[Math.floor(Math.random() * companyNames.length)];
        const randomSuffix =
          suffixes[Math.floor(Math.random() * suffixes.length)];
        const clientName = `${randomRegion}${randomName}${randomSuffix}`;

        // 随机客户类型
        const clientTypes = [
          "企业客户",
          "个人客户",
          "政府客户",
          "非盈利组织",
          "教育机构",
          "医疗机构",
        ];
        const clientType =
          clientTypes[Math.floor(Math.random() * clientTypes.length)];

        // 随机信用等级 (1-5颗星)
        const creditLevel = Math.floor(Math.random() * 5) + 1;
        const creditStars =
          "★".repeat(creditLevel) + "☆".repeat(5 - creditLevel);

        // 随机合作历史
        const cooperationHistories = [
          "良好",
          "一般",
          "首次合作",
          "长期合作",
          "优质合作",
        ];
        const cooperationHistory =
          cooperationHistories[
            Math.floor(Math.random() * cooperationHistories.length)
          ];

        return {
          clientName,
          clientType,
          creditStars,
          cooperationHistory,
        };
      }

      // 渲染订单详情
      function renderOrderDetail(order) {
        if (!order) {
          document.getElementById(
            "detail-content"
          ).innerHTML = `<div class="error"><i class="fas fa-exclamation-triangle"></i> 未找到订单信息</div>`;
          return;
        }

        // 生成随机客户信息
        const clientInfo = generateRandomClientInfo();

        // 确定进度状态类
        let progressClass = "progress-active";
        if (order["项目进度"] === "已完成") {
          progressClass = "progress-completed";
        }

        // 确定状态文本和类
        let statusClass = "status-active";
        if (order["商单状态"] === "已完成") {
          statusClass = "status-completed";
        } else if (order["商单状态"] === "待开始") {
          statusClass = "status-pending";
        }

        const progressWidth = order["项目进度"] === "已完成" ? "100%" : "65%";

        document.getElementById("detail-content").innerHTML = `
        <div class="detail-content fade-in">
          <div class="main-content">
            <div class="order-header" style="display: flex; flex-direction: column; gap: 15px;">
              <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div class="order-title">${order["商单标题"]}</div>
                <button class="back-to-home-btn" onclick="goBack()">
                  <i class="fas fa-home"></i> 返回首页
                </button>
              </div>
              <div class="order-meta">
                <span class="order-type">${order["需求类型"]}</span>
                <span class="order-status ${statusClass}">${
          order["商单状态"]
        }</span>
              </div>
            </div>
            
            <div class="info-section">
              <h3 class="info-section-title"><i class="fas fa-align-left"></i> 项目描述</h3>
              <div class="project-desc-content">
                <p class="project-desc-text">
                  这是一个详细的项目描述，包含项目的目标、范围、技术要求和预期交付成果。项目需要经验丰富的开发人员，确保按时交付高质量的成果。
                  项目将采用敏捷开发方法，定期汇报进度，确保客户满意度。
                </p>
              </div>
            </div>
            
            <div class="info-section">
              <h3 class="info-section-title"><i class="fas fa-tasks"></i> 项目需求</h3>
              <div class="requirements-content">
                <ul class="requirements-list">
                  <li>具备相关领域开发经验</li>
                  <li>熟悉项目所需技术栈</li>
                  <li>良好的沟通能力</li>
                  <li>按时交付，保证质量</li>
                  <li>提供后续技术支持</li>
                </ul>
              </div>
            </div>
            
            <div class="info-section">
              <h3 class="info-section-title"><i class="fas fa-info-circle"></i> 项目信息</h3>
              <div class="info-grid">
                <div class="info-item">
                  <div class="info-label">商单ID</div>
                  <div class="info-value">${order["商单id"]}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">需求类型</div>
                  <div class="info-value">${order["需求类型"]}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">商单状态</div>
                  <div class="info-value ${statusClass}">${
          order["商单状态"]
        }</div>
                </div>
                <div class="info-item">
                  <div class="info-label">预算范围</div>
                  <div class="info-value">¥${order["预算范围"]}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">发布时间</div>
                  <div class="info-value">${formatDate(order["发布时间"])}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">项目进度</div>
                  <div class="info-value">${order["项目进度"]}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">标签信息</div>
                  <div class="info-value">${order["标签信息"] || "无"}</div>
                </div>
              </div>
            </div>
            
            <div class="info-section">
              <h3 class="info-section-title"><i class="fas fa-user-tie"></i> 客户信息</h3>
              <div class="info-grid">
                <div class="info-item">
                  <div class="info-label">客户名称</div>
                  <div class="info-value">${clientInfo.clientName}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">客户类型</div>
                  <div class="info-value">${clientInfo.clientType}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">信用等级</div>
                  <div class="info-value">${clientInfo.creditStars}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">合作历史</div>
                  <div class="info-value">${clientInfo.cooperationHistory}</div>
                </div>
              </div>
            </div>
            
            <div class="info-section">
              <h3 class="info-section-title"><i class="fas fa-tasks"></i> 项目进度</h3>
              <div class="progress-container">
                <div class="progress-bar">
                  <div class="${progressClass}" style="width: ${progressWidth};"></div>
                </div>
                <div class="progress-text">${order["项目进度"]}</div>
              </div>
            </div>
          </div>
          
          <div class="sidebar">
              <div class="sidebar-content">
                <div class="price-section">
                  <h3 class="sidebar-title">项目预算</h3>
                  <div class="price-tag">
                    <div class="price-badge">
                      <span class="price">¥${order["预算范围"]}</span>
                    </div>
                  </div>
                  <div class="payment-info">
                    <div class="payment-item">
                      <i class="fas fa-shield-alt"></i>
                      <span>安全担保</span>
                    </div>
                    <div class="payment-item">
                      <i class="fas fa-calendar-check"></i>
                      <span>按项目约定</span>
                    </div>
                  </div>
                </div>
                
                <div class="action-section" style="margin: 25px 0;">
                  <button class="bid-btn" onclick="window.location.href='https://qm.qq.com/q/qZmbKKu6be'">我要抢单</button>
                 
                </div>
                
                <div class="project-stats">
                  <h3 class="sidebar-title">任务统计</h3>
                  <div class="stat-item">
                    <div class="stat-icon">
                      <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                      <div class="stat-label">接单人数</div>
                      <div class="stat-value">1-3人</div>
                    </div>
                  </div>
                  <div class="stat-item">
                    <div class="stat-icon">
                      <i class="fas fa-star"></i>
                    </div>
                    <div class="stat-content">
                      <div class="stat-label">优先级</div>
                      <div class="stat-value">高</div>
                    </div>
                  </div>
                  <div class="stat-item">
                    <div class="stat-icon">
                      <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-content">
                      <div class="stat-label">发布时间</div>
                      <div class="stat-value">${formatDate(
                        order["发布时间"]
                      )}</div>
                    </div>
                  </div>
                  <div class="stat-item">
                    <div class="stat-icon">
                      <i class="fas fa-briefcase"></i>
                    </div>
                    <div class="stat-content">
                      <div class="stat-label">需求类型</div>
                      <div class="stat-value">${
                        order["需求类型"] || "Web开发"
                      }</div>
                    </div>
                  </div>
                  <div class="stat-item">
                    <div class="stat-icon">
                      <i class="fas fa-tachometer-alt"></i>
                    </div>
                    <div class="stat-content">
                      <div class="stat-label">项目进度</div>
                      <div class="stat-value">${
                        order["项目进度"] || "进行中"
                      }</div>
                    </div>
                  </div>
                </div>
                
                <div class="recommended-orders">
                  <h3 class="sidebar-title">相似任务</h3>
                  <div id="recommended-projects">
                    <!-- 随机推荐的商单将在这里显示 -->
                  </div>
                </div>
              </div>
            </div>
            </div>
          </div>
        </div>
        `;
      }

      // 格式化日期
      function formatDate(dateStr) {
        if (!dateStr) return "N/A";
        // 将 "2025/11/26" 格式转换为 "2025-11-26" 格式
        if (dateStr.includes("/")) {
          const parts = dateStr.split("/");
          if (parts.length === 3) {
            return `${parts[0]}-${parts[1].padStart(
              2,
              "0"
            )}-${parts[2].padStart(2, "0")}`;
          }
        }
        return dateStr;
      }

      // 返回上一页
      function goBack() {
        window.history.back();
      }

      // 随机获取推荐订单并显示在侧边栏
      async function showRandomRecommendedOrders(currentOrderId) {
        try {
          const orders = await loadAllOrders();
          // 过滤掉当前显示的订单
          const otherOrders = orders.filter(
            (order) => order["商单id"] !== currentOrderId
          );

          // 随机选择3个订单
          const shuffled = otherOrders.sort(() => 0.5 - Math.random());
          const selectedOrders = shuffled.slice(0, 3);

          const recommendedContainer = document.getElementById(
            "recommended-projects"
          );
          if (!recommendedContainer) return;

          if (selectedOrders.length === 0) {
            recommendedContainer.innerHTML =
              '<div class="no-recommendations">暂无推荐订单</div>';
            return;
          }

          // 生成推荐订单HTML（不包含onclick事件）
          const recommendedHTML = selectedOrders
            .map(
              (order) => `
            <div class="recommended-item" data-order-id="${order["商单id"]}">
              <div class="recommended-title">
                ${order["商单标题"] || "暂无标题"}
              </div>
              <div class="recommended-meta">
                <span class="recommended-price">¥${
                  order["预算范围"] || "面议"
                }</span>
                <span class="recommended-type">${
                  order["需求类型"] || "未分类"
                }</span>
              </div>
              <div class="recommended-time">${
                formatDate(order["发布时间"]) || "未知时间"
              }</div>
            </div>
          `
            )
            .join("");

          recommendedContainer.innerHTML = recommendedHTML;

          // 为每个推荐项目添加点击事件监听器
          document.querySelectorAll(".recommended-item").forEach((item) => {
            item.addEventListener("click", function () {
              const orderId = this.getAttribute("data-order-id");
              if (orderId) {
                window.location.href = `detail.html?id=${orderId}`;
              }
            });
          });
        } catch (error) {
          console.error("加载推荐订单失败:", error);
          document.getElementById("recommended-projects").innerHTML =
            '<div class="error">推荐加载失败</div>';
        }
      }

      // 初始化页面
      async function init() {
        const orderId = getOrderIdFromUrl();
        if (!orderId) {
          document.getElementById(
            "detail-content"
          ).innerHTML = `<div class="error"><i class="fas fa-exclamation-triangle"></i> 未提供订单ID</div>`;
          return;
        }

        const orders = await loadAllOrders();
        const order = findOrderById(orders, orderId);
        renderOrderDetail(order);

        // 显示推荐订单
        await showRandomRecommendedOrders(orderId);
      }

      // 页面加载完成后初始化
      document.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>
