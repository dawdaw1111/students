<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>学员接单结果统计看板</title>
    <style>
      /* 完整保留美观样式，适配7列数据显示 */
      /* 测试提交 */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Microsoft YaHei", Arial, sans-serif;
      }
      body {
        background-color: #f5f7fa;
        min-height: 100vh;
        color: #333;
      }
      .container {
        width: 100%;
        max-width: 1400px; /* 加宽容器，适配7列数据 */
        margin: 0 auto;
        padding: 0 15px;
      }
      header {
        background-color: #fff;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        padding: 20px 0;
        margin-bottom: 20px;
      }
      .header-content {
        display: flex;
        flex-direction: column;
        gap: 12px;
        padding: 25px 0;
      }
      .header-title {
        font-size: 28px;
        font-weight: 700;
        color: #1a1a1a;
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .header-title svg {
        color: #165dff;
        width: 32px;
        height: 32px;
      }
      .header-desc {
        color: #666;
        font-size: 15px;
        line-height: 1.6;
        max-width: 800px;
        padding-left: 44px;
      }
      .header-badge {
        display: inline-block;
        background-color: #165dff;
        color: white;
        font-size: 12px;
        font-weight: 600;
        padding: 3px 8px;
        border-radius: 12px;
        margin-left: 10px;
        vertical-align: middle;
      }
      .filter-section {
        background-color: #fff;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        margin-bottom: 20px;
      }
      .filter-row {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
      }
      .filter-item {
        flex: 1;
        min-width: 180px; /* 缩小筛选框最小宽度，适配多筛选项 */
      }
      .filter-label {
        display: block;
        font-size: 14px;
        color: #666;
        margin-bottom: 5px;
        white-space: nowrap; /* 防止筛选标签换行 */
      }
      .filter-select,
      .filter-input {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        color: #333;
      }
      .filter-select:focus,
      .filter-input:focus {
        outline: none;
        border-color: #165dff;
      }
      .indicator-section {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 25px;
      }
      .indicator-card {
        flex: 1;
        min-width: 220px;
        background: linear-gradient(135deg, #ffffff 0%, #fafafa 100%);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid rgba(0, 0, 0, 0.03);
      }
      .indicator-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
      }
      .indicator-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
      }
      .indicator-info {
        display: flex;
        flex-direction: column;
      }
      .indicator-name {
        font-size: 15px;
        font-weight: 500;
        color: #666;
        margin-bottom: 8px;
        letter-spacing: 0.3px;
      }
      .indicator-value {
        font-size: 26px;
        font-weight: 700;
        color: #1a1a1a;
        line-height: 1.2;
      }
      .indicator-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        flex-shrink: 0;
      }
      .icon-primary {
        background: linear-gradient(
          135deg,
          rgba(22, 93, 255, 0.15) 0%,
          rgba(22, 93, 255, 0.1) 100%
        );
        color: #165dff;
      }
      .icon-success {
        background: linear-gradient(
          135deg,
          rgba(0, 180, 42, 0.15) 0%,
          rgba(0, 180, 42, 0.1) 100%
        );
        color: #00b42a;
      }
      .icon-secondary {
        background: linear-gradient(
          135deg,
          rgba(78, 91, 166, 0.15) 0%,
          rgba(78, 91, 166, 0.1) 100%
        );
        color: #4e5ba6;
      }
      .icon-warning {
        background: linear-gradient(
          135deg,
          rgba(255, 125, 0, 0.15) 0%,
          rgba(255, 125, 0, 0.1) 100%
        );
        color: #ff7d00;
      }
      .indicator-growth {
        font-size: 13px;
        font-weight: 500;
        color: #00b42a;
        display: flex;
        align-items: center;
        padding-top: 5px;
      }
      .indicator-growth.negative {
        color: #f53f3f;
      }
      .indicator-growth i {
        margin-right: 5px;
      }
      .table-section {
        background: linear-gradient(135deg, #ffffff 0%, #fafafa 100%);
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        overflow: hidden;
        border: 1px solid rgba(0, 0, 0, 0.03);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .table-section:hover {
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
      }
      .table-container {
        overflow-x: auto; /* 横向滚动，适配7列数据 */
      }
      .data-table {
        width: 100%;
        border-collapse: collapse;
        text-align: left;
      }
      .data-table th {
        background: linear-gradient(180deg, #f8f9fa 0%, #f1f2f4 100%);
        color: #444;
        font-size: 15px;
        font-weight: 600;
        padding: 16px 20px;
        border-bottom: 2px solid #e2e4e8;
        white-space: nowrap; /* 表头不换行，确保“学员姓名(带学号)”完整显示 */
        position: sticky;
        top: 0;
      }
      .data-table td {
        padding: 14px 20px;
        border-bottom: 1px solid #eee;
        font-size: 14px;
        color: #333;
        white-space: nowrap; /* 单元格内容不换行，保持整齐 */
        transition: background-color 0.2s ease;
      }
      .data-table tr:last-child td {
        border-bottom: none;
      }
      .data-table tr:hover td {
        background-color: #f8f9fa;
      }
      /* 针对指定字段的样式 */
      .status-tag {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
      }
      .tag-success {
        /* 接单结果-成功 */
        background-color: rgba(0, 180, 42, 0.1);
        color: #00b42a;
      }
      .tag-danger {
        /* 接单结果-失败 */
        background-color: rgba(245, 63, 63, 0.1);
        color: #f53f3f;
      }
      .tag-warning {
        /* 接单结果-进行中 */
        background-color: rgba(255, 125, 0, 0.1);
        color: #ff7d00;
      }
      .tag-primary {
        /* 接单类型标签 */
        background-color: rgba(22, 93, 255, 0.1);
        color: #165dff;
      }
      .amount-text {
        /* 金额字段加粗标蓝 */
        font-weight: bold;
        color: #165dff;
      }
      .student-text {
        /* 学员姓名(带学号)字段标灰 */
        color: #666;
      }
      .pagination-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 15px;
        background-color: #f8f9fa;
        border-top: 1px solid #eee;
      }
      .page-info {
        font-size: 14px;
        color: #666;
      }
      .page-buttons {
        display: flex;
        gap: 5px;
      }
      .page-btn {
        width: 30px;
        height: 30px;
        border-radius: 4px;
        border: 1px solid #ddd;
        background-color: #fff;
        color: #666;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        cursor: pointer;
      }
      .page-btn:hover {
        background-color: #f8f9fa;
      }
      .page-btn.active {
        background-color: #165dff;
        color: #fff;
        border-color: #165dff;
      }
      .page-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      footer {
        background-color: #fff;
        border-top: 1px solid #eee;
        padding: 15px 0;
        margin-top: 20px;
        text-align: center;
      }
      .footer-text {
        font-size: 12px;
        color: #666;
      }
      .loading-cell {
        text-align: center;
        color: #666;
        font-size: 14px;
        padding: 30px 0; /* 增加加载提示高度，更醒目 */
      }
      .error-cell {
        text-align: center;
        color: #f53f3f;
        font-size: 14px;
        padding: 30px 0;
      }
    </style>
    <!-- 内置SVG图标 -->
    <style>
      .icon {
        display: inline-block;
        width: 1em;
        height: 1em;
        stroke-width: 0;
        stroke: currentColor;
        fill: currentColor;
      }
      .icon-bar-chart {
        width: 1.1428571428571428em;
      }
      .icon-list-alt {
        width: 1.1428571428571428em;
      }
      .icon-check-circle {
        width: 1.1428571428571428em;
      }
      .icon-rmb {
        width: 0.8571428571428571em;
      }
      .icon-users {
        width: 1.1428571428571428em;
      }
      .icon-arrow-up {
        width: 0.7142857142857143em;
      }
      .icon-spinner {
        animation: spin 2s linear infinite;
        width: 1em;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .icon-exclamation-circle {
        width: 1.1428571428571428em;
      }
      .icon-info-circle {
        width: 1.1428571428571428em;
      }
      .icon-chevron-left {
        width: 0.5714285714285714em;
      }
      .icon-chevron-right {
        width: 0.5714285714285714em;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="container">
        <div class="header-content">
          <h1 class="header-title">
            <svg class="icon icon-bar-chart" viewBox="0 0 14 14">
              <path
                d="M13 2v10H1V2h12zm0-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V2c0-.55-.45-1-1-1z"
              />
              <path d="M3 10h2V7H3v3zm4 0h2V3H7v7zm4 0h2V5h-2v5z" />
            </svg>
            学员接单结果统计看板
            <span class="header-badge">实时数据</span>
          </h1>
          <!-- <p class="header-desc">
            系统自动加载并分析 data/接单结果统计表.csv
            文件，精准展示学员接单情况。
            <br />数据维度包括：序号、接单类型、学员姓名(带学号)、学员接单时间、接单结果、金额、接单人员。
          </p> -->
        </div>
      </div>
    </header>

    <main class="container">
      <!-- 筛选区（适配指定表头的筛选项） -->
      <section id="filterSection" class="filter-section" style="display: none">
        <div class="filter-row">
          <!-- 接单类型筛选 -->
          <div class="filter-item">
            <label class="filter-label">接单类型</label>
            <select id="typeFilter" class="filter-select">
              <option value="">全部类型</option>
            </select>
          </div>
          <!-- 学员姓名(带学号)筛选 -->
          <div class="filter-item">
            <label class="filter-label">学员姓名(带学号)</label>
            <input
              id="studentFilter"
              type="text"
              placeholder="输入姓名/学号搜索"
              class="filter-input"
            />
          </div>
          <!-- 接单结果筛选 -->
          <div class="filter-item">
            <label class="filter-label">接单结果</label>
            <select id="resultFilter" class="filter-select">
              <option value="">全部结果</option>
            </select>
          </div>
          <!-- 接单人员筛选 -->
          <div class="filter-item">
            <label class="filter-label">接单人员</label>
            <select id="staffFilter" class="filter-select">
              <option value="">全部人员</option>
            </select>
          </div>
          <!-- 接单时间筛选（月份筛选） -->
          <div class="filter-item">
            <label class="filter-label">接单月份</label>
            <select id="timeFilter" class="filter-select">
              <option value="">全部月份</option>
            </select>
          </div>
        </div>
      </section>

      <!-- 核心指标概览（基于指定表头计算） -->
      <section
        id="indicatorSection"
        class="indicator-section"
        style="display: none"
      >
        <!-- 总订单数 -->
        <div class="indicator-card">
          <div class="indicator-header">
            <div class="indicator-info">
              <div class="indicator-name">总订单数</div>
              <div id="totalOrder" class="indicator-value">0</div>
            </div>
            <div class="indicator-icon icon-primary">
              <svg class="icon icon-list-alt" viewBox="0 0 14 14">
                <path
                  d="M13 3H1c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1zm0 9H1V4h12v8z"
                />
                <path d="M3 5h8v1H3V5zm0 2h8v1H3V7zm0 2h8v1H3V9z" />
              </svg>
            </div>
          </div>
          <div id="orderGrowth" class="indicator-growth">
            <svg class="icon icon-arrow-up" viewBox="0 0 14 14">
              <path d="M7 14l-7-7 1.41-1.41L7 11.17l5.59-5.59L14 7l-7 7z" />
            </svg>
            较上月增长 12%
          </div>
        </div>
        <!-- 成功订单数 -->
        <div class="indicator-card">
          <div class="indicator-header">
            <div class="indicator-info">
              <div class="indicator-name">成功订单数</div>
              <div
                id="successOrder"
                class="indicator-value"
                style="color: #00b42a"
              >
                0
              </div>
            </div>
            <div class="indicator-icon icon-success">
              <svg class="icon icon-check-circle" viewBox="0 0 14 14">
                <path
                  d="M7 14A7 7 0 1 1 7 0a7 7 0 0 1 0 14zm0-1.333a5.667 5.667 0 1 0 0-11.334 5.667 5.667 0 0 0 0 11.334z"
                />
                <path
                  d="M11.334 6.001L5.667 11.667 2.666 8.667l1.133-1.133 1.867 1.867 4.5-4.5 1.133 1.133z"
                />
              </svg>
            </div>
          </div>
          <div id="successRate" class="indicator-growth">
            <svg class="icon icon-arrow-up" viewBox="0 0 14 14">
              <path d="M7 14l-7-7 1.41-1.41L7 11.17l5.59-5.59L14 7l-7 7z" />
            </svg>
            成功率 0%
          </div>
        </div>
        <!-- 总金额 -->
        <div class="indicator-card">
          <div class="indicator-header">
            <div class="indicator-info">
              <div class="indicator-name">总金额（元）</div>
              <div
                id="totalAmount"
                class="indicator-value"
                style="color: #4e5ba6"
              >
                0
              </div>
            </div>
            <div class="indicator-icon icon-secondary">
              <svg class="icon icon-rmb" viewBox="0 0 10 14">
                <path
                  d="M10 7.333c0 .55-.45 1-1 1H7v1.667c0 .55-.45 1-1 1s-1-.45-1-1V8.333H2c-.55 0-1-.45-1-1s.45-1 1-1h2V5c0-.55.45-1 1-1s1 .45 1 1v1.333h2c.55 0 1 .45 1 1zM8 4.667H6V2c0-.55-.45-1-1-1S4 1.45 4 2v2.667H2c-.55 0-1 .45-1 1s.45 1 1 1h6c.55 0 1-.45-1-1s-.45-1-1-1z"
                />
              </svg>
            </div>
          </div>
          <div id="amountGrowth" class="indicator-growth">
            <svg class="icon icon-arrow-up" viewBox="0 0 14 14">
              <path d="M7 14l-7-7 1.41-1.41L7 11.17l5.59-5.59L14 7l-7 7z" />
            </svg>
            较上月增长 18%
          </div>
        </div>
        <!-- 活跃学员数 -->
        <div class="indicator-card">
          <div class="indicator-header">
            <div class="indicator-info">
              <div class="indicator-name">活跃学员数</div>
              <div id="activeStudent" class="indicator-value">0</div>
            </div>
            <div class="indicator-icon icon-warning">
              <svg class="icon icon-users" viewBox="0 0 14 14">
                <path
                  d="M13 11c0 .55-.45 1-1 1H2c-.55 0-1-.45-1-1v-1c0-.55.45-1 1-1h10c.55 0 1 .45 1 1v1zm0-2c0 .55-.45 1-1 1H2c-.55 0-1-.45-1-1V8c0-.55.45-1 1-1h10c.55 0 1 .45 1 1v1zm0-2c0 .55-.45 1-1 1H2c-.55 0-1-.45-1-1V6c0-.55.45-1 1-1h10c.55 0 1 .45 1 1v1zm0-2c0 .55-.45 1-1 1H2c-.55 0-1-.45-1-1V4c0-.55.45-1 1-1h10c.55 0 1 .45 1 1v1z"
                />
                <path
                  d="M7 5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0-3c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1z"
                />
              </svg>
            </div>
          </div>
          <div id="studentGrowth" class="indicator-growth">
            <svg class="icon icon-arrow-up" viewBox="0 0 14 14">
              <path d="M7 14l-7-7 1.41-1.41L7 11.17l5.59-5.59L14 7l-7 7z" />
            </svg>
            较上月增长 8%
          </div>
        </div>
      </section>

      <!-- 表格区（固定显示7列指定表头） -->
      <section class="table-section">
        <div class="table-container">
          <table class="data-table">
            <!-- 固定表头：序号、接单类型、学员姓名(带学号)、学员接单时间、接单结果、金额、接单人员 -->
            <thead id="tableHeader">
              <tr>
                <th colspan="7" class="loading-cell">
                  <svg class="icon icon-spinner" viewBox="0 0 14 14">
                    <path
                      d="M7 14A7 7 0 1 1 7 0a7 7 0 0 1 0 14zm0-1.333a5.667 5.667 0 1 0 0-11.334 5.667 5.667 0 0 0 0 11.334z"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="1.5"
                    />
                  </svg>
                  正在自动加载data/接单结果统计表.csv...
                </th>
              </tr>
            </thead>
            <!-- 表格体（动态加载数据） -->
            <tbody id="tableBody">
              <!-- 数据加载后生成 -->
            </tbody>
          </table>
        </div>
        <!-- 分页区 -->
        <div
          id="paginationSection"
          class="pagination-section"
          style="display: none"
        >
          <div id="pageInfo" class="page-info">显示 0-0 条，共 0 条</div>
          <div class="page-buttons">
            <button id="prevPage" class="page-btn" disabled>
              <svg class="icon icon-chevron-left" viewBox="0 0 10 14">
                <path
                  d="M8.667 1.333L5.333 4.667 2 1.333.667 2.667 5.333 7 .667 11.333 2 12.667 5.333 9.333 8.667 12.667 10 11.333 5.333 7 10 2.667 8.667 1.333z"
                />
              </svg>
            </button>
            <button id="currentPage" class="page-btn active">1</button>
            <button id="nextPage" class="page-btn" disabled>
              <svg class="icon icon-chevron-right" viewBox="0 0 10 14">
                <path
                  d="M1.333 12.667L4.667 9.333 8 12.667 9.333 11.333 4.667 7 9.333 2.667 8 1.333 4.667 4.667 1.333 1.333 0 2.667 4.667 7 0 11.333 1.333 12.667z"
                />
              </svg>
            </button>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <div class="footer-text">
        © 2025 学员接单管理系统 | 数据更新时间：<span id="updateTime"></span>
      </div>
    </footer>

    <script>
      // 全局变量（适配7列指定表头）
      const targetHeaders = [
        "序号",
        "接单类型",
        "学员姓名(带学号)",
        "学员接单时间",
        "接单结果",
        "金额",
        "辅导老师",
      ]; // 固定目标表头

      // 实际CSV表头（用于验证）
      const actualCsvHeaders = [
        "序号",
        "接单类型",
        "学员姓名(带学号)",
        "学员接单时间",
        "接单结果",
        "金额",
        "接单人员",
        "截图（第二天截图，要求有日期）",
        "",
        "",
      ];
      let csvData = []; // CSV数据（排除表头行）
      let filteredData = []; // 筛选后数据
      let currentPage = 1; // 当前页码
      const pageSize = 10; // 每页条数
      const csvFilePath = "data/接单结果统计表.csv"; // 固定文件路径

      // 发送消息给父页面以调整iframe高度
      function sendHeightToParent() {
        const height = Math.max(
          document.body.scrollHeight,
          document.body.offsetHeight,
          document.documentElement.clientHeight,
          document.documentElement.scrollHeight,
          document.documentElement.offsetHeight
        );

        // 向父窗口发送高度信息
        parent.postMessage(
          {
            type: "resizeIframe",
            height: height + 50, // 增加一些额外空间
          },
          "*"
        );
      }

      // 页面加载完成后自动读取CSV
      window.onload = function () {
        document.getElementById("updateTime").textContent =
          new Date().toLocaleString();
        try {
          loadCSVFile();
        } catch (error) {
          console.error("加载CSV文件时发生错误:", error);
        }

        // 页面加载完成后也发送高度信息
        setTimeout(sendHeightToParent, 500); // 稍长延迟确保内容完全加载
      };

      /**
       * 加载并验证CSV文件（确保表头与目标一致）
       */
      function loadCSVFile() {
        fetch(csvFilePath)
          .then((response) => {
            if (!response.ok) {
              throw new Error(
                `文件加载失败：请确认 ${csvFilePath} 存在\n（需放在HTML同级的data文件夹中）`
              );
            }
            return response.text();
          })
          .then((content) => {
            // 解析CSV（正确处理跨行字段）
            const rows = parseCSV(content);
            if (rows.length < 2)
              throw new Error("CSV文件数据不足（需包含表头和至少1行数据）");

            // 提取CSV表头并验证
            const csvHeaders = rows[0];

            // 不再严格验证表头，只要求至少有1列
            if (csvHeaders.length < 1) {
              throw new Error(
                `CSV文件列数不足！至少需要1列，当前只有${csvHeaders.length}列`
              );
            }

            // 如果列数少于7列，给出警告但继续执行
            if (csvHeaders.length < 7) {
              console.warn(
                `CSV文件列数较少，只有${csvHeaders.length}列，期望至少7列`
              );
            }

            // 提取CSV数据（排除表头行并过滤空行和无效行）
            csvData = rows.slice(1).filter((row) => {
              // 检查行是否不为空且第一列是数字
              return (
                row.length > 0 &&
                row[0] &&
                row[0].toString().trim() !== "" &&
                !isNaN(parseInt(row[0]))
              );
            });
            filteredData = [...csvData];

            // 初始化页面元素
            renderFixedHeader(); // 渲染固定表头
            renderTableBody(); // 渲染表格数据
            initFilterOptions(); // 初始化筛选框选项
            renderIndicators(); // 渲染核心指标
            bindFilterEvents(); // 绑定筛选事件
            bindPaginationEvents(); // 绑定分页事件

            // 显示筛选区和指标区
            document.getElementById("filterSection").style.display = "block";
            document.getElementById("indicatorSection").style.display = "flex";
            document.getElementById("paginationSection").style.display = "flex";

            // 发送高度给父页面
            setTimeout(sendHeightToParent, 100); // 稍微延迟确保DOM完全渲染
          })
          .catch((error) => {
            // 显示错误信息
            document.getElementById("tableHeader").innerHTML = `
                        <tr>
                            <th colspan="7" class="error-cell">
                                <svg class="icon icon-exclamation-circle" viewBox="0 0 14 14">
                                    <path d="M7 14A7 7 0 1 1 7 0a7 7 0 0 1 0 14zm0-1.333a5.667 5.667 0 1 0 0-11.334 5.667 5.667 0 0 0 0 11.334z"/>
                                    <path d="M7 4.667c.55 0 1 .45 1 1v.666c0 .55-.45 1-1 1s-1-.45-1-1V5.667c0-.55.45-1 1-1zm0 3.333c.28 0 .5.22.5.5s-.22.5-.5.5-.5-.22-.5-.5.22-.5.5-.5z"/>
                                </svg>
                                ${error.message}
                            </th>
                        </tr>
                    `;
            document.getElementById("tableBody").innerHTML = "";
            console.error("CSV加载错误：", error);
          });
      }

      /**
       * 解析CSV内容（正确处理跨行字段）
       */
      function parseCSV(content) {
        const lines = [];
        let currentLine = "";
        let inQuotes = false;

        for (let i = 0; i < content.length; i++) {
          const char = content[i];
          const nextChar = content[i + 1];

          if (char === '"' && !inQuotes) {
            // 开始引号
            inQuotes = true;
            currentLine += char;
          } else if (char === '"' && inQuotes && nextChar !== '"') {
            // 结束引号（下一个字符不是引号）
            inQuotes = false;
            currentLine += char;
          } else if (
            (char === "\n" || (char === "\r" && nextChar === "\n")) &&
            !inQuotes
          ) {
            // 行结束符（不在引号内）
            if (char === "\r") {
              i++; // 跳过\n
            }
            // 移除可能的BOM标记
            if (currentLine.charCodeAt(0) === 0xfeff) {
              currentLine = currentLine.slice(1);
            }
            lines.push(currentLine);
            currentLine = "";
          } else {
            // 普通字符
            currentLine += char;
          }
        }

        // 添加最后一行（如果有内容）
        if (currentLine) {
          // 移除可能的BOM标记
          if (currentLine.charCodeAt(0) === 0xfeff) {
            currentLine = currentLine.slice(1);
          }
          lines.push(currentLine);
        }

        // 解析每一行
        return lines.map((line) => parseCSVLine(line));
      }

      /**
       * 解析单行CSV（支持带引号的字段，如"学员姓名(带学号)"）
       */
      function parseCSVLine(line) {
        const cells = [];
        let inQuotes = false;
        let currentCell = "";
        let i = 0;

        while (i < line.length) {
          const char = line[i];
          const nextChar = line[i + 1];

          if (char === '"' && !inQuotes) {
            // 开始引号
            inQuotes = true;
            // 不添加引号到currentCell
          } else if (char === '"' && inQuotes && nextChar === '"') {
            // 双引号转义
            currentCell += '"';
            i++; // 跳过下一个引号
          } else if (char === '"' && inQuotes) {
            // 结束引号
            inQuotes = false;
            // 不添加引号到currentCell
          } else if (char === "," && !inQuotes) {
            // 字段分隔符
            cells.push(currentCell.trim());
            currentCell = "";
          } else {
            // 普通字符
            currentCell += char;
          }

          i++;
        }

        // 添加最后一个字段
        cells.push(currentCell.trim());

        return cells;
      }

      /**
       * 渲染固定表头（与目标表头完全一致）
       */
      function renderFixedHeader() {
        const headerElement = document.getElementById("tableHeader");
        let headerHtml = "<tr>";
        // 遍历目标表头，生成<th>标签
        targetHeaders.forEach((header) => {
          headerHtml += `<th>${header}</th>`;
        });
        headerHtml += "</tr>";
        headerElement.innerHTML = headerHtml;
      }

      /**
       * 渲染表格体（适配7列数据，按字段添加样式）
       */
      function renderTableBody() {
        const bodyElement = document.getElementById("tableBody");
        const totalData = filteredData.length;
        const totalPages = Math.ceil(totalData / pageSize);
        const startIndex = (currentPage - 1) * pageSize;
        const endIndex = Math.min(startIndex + pageSize, totalData);
        const currentPageData = filteredData.slice(startIndex, endIndex);

        // 更新分页信息
        document.getElementById("pageInfo").textContent = `显示 ${
          startIndex + 1
        }-${endIndex} 条，共 ${totalData} 条`;
        document.getElementById("currentPage").textContent = currentPage;
        document.getElementById("prevPage").disabled = currentPage === 1;
        document.getElementById("nextPage").disabled =
          currentPage === totalPages;

        // 无数据时显示提示
        if (currentPageData.length === 0) {
          bodyElement.innerHTML = `
                    <tr>
                        <td colspan="7" class="loading-cell">
                            <svg class="icon icon-info-circle" viewBox="0 0 14 14">
                                <path d="M7 14A7 7 0 1 1 7 0a7 7 0 0 1 0 14zm0-1.333a5.667 5.667 0 1 0 0-11.334 5.667 5.667 0 0 0 0 11.334z"/>
                                <path d="M7 4.667c.55 0 1 .45 1 1v.666c0 .55-.45 1-1 1s-1-.45-1-1V5.667c0-.55.45-1 1-1zm0 3.333c.28 0 .5.22.5.5s-.22.5-.5.5-.5-.22-.5-.5.22-.5.5-.5z"/>
                            </svg>
                            暂无匹配数据
                        </td>
                    </tr>
                `;
          return;
        }

        // 动态生成表格行（7列对应7个字段）
        let bodyHtml = "";
        currentPageData.forEach((row, rowIndex) => {
          // 提取7列数据（对应目标表头顺序）
          // 序号从1开始连续显示，而不是使用CSV中的值
          const 序号 = startIndex + rowIndex + 1;
          const 接单类型 = row[1] || "";
          const 学员姓名带学号 = row[2] || "";
          const 学员接单时间 = row[3] || "";
          const 接单结果 = row[4] || "";
          const 金额 = row[5] || "0";
          const 接单人员 = row[6] || "";

          // 接单结果样式（成功/失败/进行中）
          let resultTag = "";
          if (接单结果.includes("成功") || 接单结果 === "完成") {
            resultTag = `<span class="status-tag tag-success">${接单结果}</span>`;
          } else if (接单结果.includes("失败") || 接单结果 === "取消") {
            resultTag = `<span class="status-tag tag-danger">${接单结果}</span>`;
          } else if (接单结果.includes("进行中") || 接单结果 === "待完成") {
            resultTag = `<span class="status-tag tag-warning">${接单结果}</span>`;
          } else {
            resultTag = `<span class="status-tag tag-gray">${接单结果}</span>`;
          }

          // 接单类型样式
          const typeTag = `<span class="status-tag tag-primary">${接单类型}</span>`;

          // 金额样式（加粗标蓝）
          const amountText = `<span class="amount-text">${金额}</span>`;

          // 学员姓名带学号样式（标灰）
          const studentText = `<span class="student-text">${学员姓名带学号}</span>`;

          // 生成表格行
          bodyHtml += `
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td>${序号}</td>
                        <td>${typeTag}</td>
                        <td>${studentText}</td>
                        <td>${学员接单时间}</td>
                        <td>${resultTag}</td>
                        <td>${amountText}</td>
                        <td>${接单人员}</td>
                    </tr>
                `;
        });

        bodyElement.innerHTML = bodyHtml;
      }

      /**
       * 初始化筛选框选项（从CSV数据中提取）
       */
      function initFilterOptions() {
        // 1. 接单类型选项（去重）
        const typeFilter = document.getElementById("typeFilter");
        const allTypes = [
          ...new Set(csvData.map((row) => row[1] || "")),
        ].filter((t) => t);
        allTypes.forEach((type) => {
          const option = document.createElement("option");
          option.value = type;
          option.textContent = type;
          typeFilter.appendChild(option);
        });

        // 2. 接单结果选项（去重）
        const resultFilter = document.getElementById("resultFilter");
        const allResults = [
          ...new Set(csvData.map((row) => row[4] || "")),
        ].filter((r) => r);
        allResults.forEach((result) => {
          const option = document.createElement("option");
          option.value = result;
          option.textContent = result;
          resultFilter.appendChild(option);
        });

        // 3. 接单人员选项（去重）
        const staffFilter = document.getElementById("staffFilter");
        const allStaff = [
          ...new Set(csvData.map((row) => row[6] || "")),
        ].filter((s) => s);
        allStaff.forEach((staff) => {
          const option = document.createElement("option");
          option.value = staff;
          option.textContent = staff;
          staffFilter.appendChild(option);
        });

        // 4. 接单月份选项（从接单时间提取月份）
        const timeFilter = document.getElementById("timeFilter");
        const allMonths = [
          ...new Set(
            csvData
              .map((row) => {
                const time = row[3] || "";
                // 提取月份（支持格式：2025-12-18、2025/12/18）
                const monthMatch = time.match(/(\d{4})[-/](\d{2})/);
                return monthMatch ? `${monthMatch[1]}年${monthMatch[2]}月` : "";
              })
              .filter((m) => m)
          ),
        ];
        allMonths.forEach((month) => {
          const option = document.createElement("option");
          option.value = month;
          option.textContent = month;
          timeFilter.appendChild(option);
        });
      }

      /**
       * 渲染核心指标（基于7列数据计算）
       */
      function renderIndicators() {
        const totalOrder = filteredData.length;
        // 成功订单数（接单结果包含“成功”或“完成”）
        const successOrder = filteredData.filter((row) => {
          const result = row[4] || "";
          return result.includes("成功") || result === "完成";
        }).length;
        // 总金额（第6列“金额”）
        const totalAmount = filteredData.reduce((sum, row) => {
          const amount = parseFloat(row[5]) || 0;
          return sum + amount;
        }, 0);
        // 活跃学员数（第3列“学员姓名(带学号)”去重）
        const activeStudent = [
          ...new Set(filteredData.map((row) => row[2] || "")),
        ].filter((s) => s).length;
        // 成功率
        const successRate =
          totalOrder > 0
            ? ((successOrder / totalOrder) * 100).toFixed(1) + "%"
            : "0%";

        // 更新指标显示
        document.getElementById("totalOrder").textContent = totalOrder;
        document.getElementById("successOrder").textContent = successOrder;
        document.getElementById("totalAmount").textContent =
          totalAmount.toLocaleString();
        document.getElementById("activeStudent").textContent = activeStudent;
        document.getElementById(
          "successRate"
        ).textContent = `成功率 ${successRate}`;
      }

      /**
       * 绑定筛选事件（多条件联合筛选）
       */
      function bindFilterEvents() {
        // 接单类型筛选
        document
          .getElementById("typeFilter")
          .addEventListener("change", filterData);
        // 学员姓名(带学号)筛选（实时输入）
        document
          .getElementById("studentFilter")
          .addEventListener("input", filterData);
        // 接单结果筛选
        document
          .getElementById("resultFilter")
          .addEventListener("change", filterData);
        // 接单人员筛选
        document
          .getElementById("staffFilter")
          .addEventListener("change", filterData);
        // 接单月份筛选
        document
          .getElementById("timeFilter")
          .addEventListener("change", filterData);
      }

      /**
       * 多条件筛选数据
       */
      function filterData() {
        // 获取筛选条件
        const typeValue = document.getElementById("typeFilter").value;
        const studentValue = document
          .getElementById("studentFilter")
          .value.trim()
          .toLowerCase();
        const resultValue = document.getElementById("resultFilter").value;
        const staffValue = document.getElementById("staffFilter").value;
        const timeValue = document.getElementById("timeFilter").value;

        // 重置页码
        currentPage = 1;

        // 多条件筛选
        filteredData = csvData.filter((row) => {
          const rowType = row[1] || "";
          const rowStudent = (row[2] || "").toLowerCase();
          const rowResult = row[4] || "";
          const rowStaff = row[6] || "";
          const rowTime = row[3] || "";

          // 接单类型匹配
          const typeMatch = !typeValue || rowType === typeValue;
          // 学员姓名/学号匹配（包含匹配）
          const studentMatch =
            !studentValue || rowStudent.includes(studentValue);
          // 接单结果匹配
          const resultMatch = !resultValue || rowResult === resultValue;
          // 接单人员匹配
          const staffMatch = !staffValue || rowStaff === staffValue;
          // 接单月份匹配（从时间中提取月份）
          let timeMatch = true;
          if (timeValue) {
            const monthMatch = rowTime.match(/(\d{4})[-/](\d{2})/);
            const rowMonth = monthMatch
              ? `${monthMatch[1]}年${monthMatch[2]}月`
              : "";
            timeMatch = rowMonth === timeValue;
          }

          // 所有条件满足则保留
          return (
            typeMatch && studentMatch && resultMatch && staffMatch && timeMatch
          );
        });

        // 重新渲染表格和指标
        renderTableBody();
        renderIndicators();
      }

      /**
       * 绑定分页事件
       */
      function bindPaginationEvents() {
        // 上一页
        document.getElementById("prevPage").addEventListener("click", () => {
          if (currentPage > 1) {
            currentPage--;
            renderTableBody();
          }
        });

        // 下一页
        document.getElementById("nextPage").addEventListener("click", () => {
          const totalPages = Math.ceil(filteredData.length / pageSize);
          if (currentPage < totalPages) {
            currentPage++;
            renderTableBody();
          }
        });
      }
    </script>
  </body>
</html>
